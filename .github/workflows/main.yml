# .github/workflows/build.yml
name: Build KidsSafeBrowser

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build-linux:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20
      - run: npm install
      - run: npm run build -- -l
      - uses: actions/upload-artifact@v4
        with:
          name: KidsSafeBrowser-Linux
          path: dist/*.AppImage

  # build-windows:
  #   runs-on: windows-latest
  #   steps:
  #     - uses: actions/checkout@v4
  #     - uses: actions/setup-node@v4
  #       with:
  #         node-version: 20
  #     - run: npm install
  #     - run: npm run build -- -w
  #     - uses: actions/upload-artifact@v4
  #       with:
  #         name: KidsSafeBrowser-Windows
  #         path: dist/*.exe

  # build-macos:
  #   runs-on: macos-latest
  #   steps:
  #     - uses: actions/checkout@v4
  #     - uses: actions/setup-node@v4
  #       with:
  #         node-version: 20
  #     - run: npm install
  #     - run: npm run build -- -m
  #     - uses: actions/upload-artifact@v4
  #       with:
  #         name: KidsSafeBrowser-macOS
  #         path: dist/*.dmg


  release:
  # needs: [build-linux, build-windows, build-macos]
  needs: [build-linux]
  runs-on: ubuntu-latest
  steps:
    - name: Download all artifacts
      uses: actions/download-artifact@v4
      with:
        path: artifacts

    - name: Create tag
      run: |
        git config --global user.name "github-actions"
        git config --global user.email "actions@github.com"
        git tag v${{ github.run_number }}
        git push origin v${{ github.run_number }}

    - name: Create GitHub Release
      uses: softprops/action-gh-release@v1
      with:
        files: artifacts/**/*
        tag_name: v${{ github.run_number }}
        name: "Release v${{ github.run_number }}"
        draft: false
        prerelease: false
        token: ${{ secrets.GH_TOKEN }}

